<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Bitcoin price prediction - ysmiles home new</title><meta name="Description" content="ysmiles test params description"><meta property="og:title" content="Bitcoin price prediction" />
<meta property="og:description" content="1. Introduction This is a small project to learn basics of TensorFlow and solving time series problems with RNN. For more details, please refer to the codes at Github: ysmiles.
1.1 Time-series A time series is a series of data points indexed (or listed or graphed) in time order. Most commonly, a time series is a sequence taken at successive equally spaced points in time. Thus it is a sequence of discrete-time data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ysmiles.com/posts/bitcoin-price-prediction/" /><meta property="og:image" content="https://ysmiles.com/47"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-02-04T23:09:26-08:00" /><meta property="og:site_name" content="ysmiles test params title" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ysmiles.com/47"/>

<meta name="twitter:title" content="Bitcoin price prediction"/>
<meta name="twitter:description" content="1. Introduction This is a small project to learn basics of TensorFlow and solving time series problems with RNN. For more details, please refer to the codes at Github: ysmiles.
1.1 Time-series A time series is a series of data points indexed (or listed or graphed) in time order. Most commonly, a time series is a sequence taken at successive equally spaced points in time. Thus it is a sequence of discrete-time data."/>
<meta name="application-name" content="app title">
<meta name="apple-mobile-web-app-title" content="app title"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://ysmiles.com/posts/bitcoin-price-prediction/" /><link rel="prev" href="https://ysmiles.com/posts/run-a-basic-grpc-example-with-docker/" /><link rel="next" href="https://ysmiles.com/posts/http-server-inside-a-docker-container/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Bitcoin price prediction",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/ysmiles.com\/posts\/bitcoin-price-prediction\/"
        },"genre": "posts","keywords": "TensorFlow, RNN, Bitcoin","wordcount":  1733 ,
        "url": "https:\/\/ysmiles.com\/posts\/bitcoin-price-prediction\/","datePublished": "2017-10-22T00:00:00+00:00","dateModified": "2023-02-04T23:09:26-08:00","license": "copyright test","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Frederick"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="ysmiles home new">ysmiles</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="ysmiles home new">ysmiles</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Bitcoin price prediction</h1><h2 class="single-subtitle">A basic time series problem solving with RNN on TensorFlow</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://ysmiles.com" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Frederick</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2017-10-22">2017-10-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1733 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-introduction">1. Introduction</a>
      <ul>
        <li><a href="#11-time-series">1.1 Time-series</a></li>
        <li><a href="#12-recurrent-neural-networks-rnn">1.2 Recurrent Neural Networks (RNN)</a></li>
      </ul>
    </li>
    <li><a href="#2-implementation">2. Implementation</a>
      <ul>
        <li><a href="#21-installation-of-tensorflow">2.1 Installation of Tensorflow</a></li>
        <li><a href="#22-data-preparation">2.2 Data preparation</a></li>
        <li><a href="#23-data-processing">2.3 Data processing</a></li>
      </ul>
    </li>
    <li><a href="#3-visualization">3. Visualization</a>
      <ul>
        <li><a href="#31-windowslinux">3.1 Windows/Linux</a></li>
        <li><a href="#32-web-interface">3.2 Web interface</a></li>
      </ul>
    </li>
    <li><a href="#4-discussion-and-summary">4. Discussion and Summary</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="1-introduction">1. Introduction</h2>
<p>This is a small project to learn basics of TensorFlow and solving time series problems with RNN.
For more details, please refer to the codes at <a href="https://github.com/ysmiles/tensorflow-learn/tree/master/bitcoinPricePredict" target="_blank" rel="noopener noreffer ">Github: ysmiles</a>.</p>
<h3 id="11-time-series">1.1 Time-series</h3>
<p>A time series is a series of data points indexed (or listed or graphed) in time order. Most commonly, a time series is a sequence taken at successive equally spaced points in time. Thus it is a sequence of discrete-time data.</p>
<p>1-D time series examples include weather information, stock exchange information, voice information (if we only consider strength or frequency).</p>
<p>Bitcoin price is similar to stocks but may changes more fast.
For example, at the beginning of this month (2017-10-01) it was around <strong>$4400</strong>, and now (2017-10-20) it is almost <strong>$6000</strong>, with the increasing ratio of more than <strong>36%</strong>.
So accurate prediction of future prices of Bitcoin is very attractive.</p>
<h3 id="12-recurrent-neural-networks-rnn">1.2 Recurrent Neural Networks (RNN)</h3>
<p>Recurrent Neural Networks (RNNs) are called recurrent because they perform the same computations for all elements in a sequence of inputs.</p>
<p>RNNs are good at analyze time series data, such as stock prices, and provide forecasts.
This is why this homework chose this method.</p>
<p>RNNs can also take sentences, documents, or audio, etc as input, making them extremely useful for natural language processing (NLP) systems, such as automatic translation, speech-to-text, or sentiment analysis.
Overall this method can be applied in many situations where a sequence of data points exists.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/rnn.png"
        data-srcset="/images/bitcoinprice/rnn.png, /images/bitcoinprice/rnn.png 1.5x, /images/bitcoinprice/rnn.png 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/rnn.png"
        title="rnn" /></p>
<p>This image shows the RNN architecture.</p>
<p><code>xt</code> is the input at time step <code>t</code>. For example, in this project <code>x1</code> could be the first price of Bitcoin in a specific time period.
<code>st</code> is the hidden state at time step <code>tn</code> and is calculated based on the previous hidden state and the input at the current step, using an activation function.
<code>St-1</code> is usually initialized to zero.
<code>ot</code> is the output at step <code>t</code>.
For example, if we wanted to predict the next value in a sequence, it would be a vector of probabilities across our time series.</p>
<p>RNN cells are developed on the notion that one input is dependent on the previous input by having a hidden state, or memory, that captures what has been seen so far.
The value of the hidden state at any point in time is a function of the value of the hidden state at the previous time step and the value of the input at the current time step.
In this project, I divide time serial data points as 20 days block. Actually what the whole program do is to finding feature and use 20 days price to predict price of 21st day.</p>
<h2 id="2-implementation">2. Implementation</h2>
<h3 id="21-installation-of-tensorflow">2.1 Installation of Tensorflow</h3>
<p>Install Tensorflow at a linux server or desktop is not that hard. Here is a summary of installation bach commands from official guide.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># for ubuntu</span>
$ sudo apt-get install python3-pip python3-dev python-virtualenv <span class="c1"># for Python 3.n</span>
$ virtualenv --system-site-packages -p python3 ~/tensorflow <span class="c1"># for Python 3.n</span>
$ <span class="nb">source</span> ~/tensorflow/bin/activate <span class="c1"># bash, sh, ksh, or zsh</span>
<span class="c1"># Assume at least have python 3.5</span>
<span class="o">(</span>tensorflow<span class="o">)</span>$ pip3 install --upgrade tensorflow     <span class="c1"># for Python 3.n</span>
</code></pre></div><p>One note here is to use <code>virtualenv</code>, which provide a separated python environment to tensorflow.
The goodness of this is that inside this environment, we do not need to care python or python3, pip or pip3, etc.
In my case, it only has python 3 inside.
Because linux servers always have some python 2 version(s), which is quite annoying for stricting version every time.
So this <code>virtualenv</code> does help.
Just remember to <code>activate</code> it as showed above.</p>
<p>I also test this project at Windows 10.
At the beginning I installed it in Anaconda, but it turned out to be with some problems.
So I uninstalled Anaconda and installed official python 3.6 and used native installation with pip.
It worked well.</p>
<p>At Windows system, here is another note.
For some packages, the pip installation requires outside library that generally windows does not have.
To solve this, one could go to following page to download compiled version of packages and then use local pip install.</p>
<p><a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="noopener noreffer ">http://www.lfd.uci.edu/~gohlke/pythonlibs/</a></p>
<h3 id="22-data-preparation">2.2 Data preparation</h3>
<h4 id="221-fetching-data">2.2.1 Fetching data</h4>
<p>To meet the requirement &ldquo;load data from remote&rdquo;, there are two basic choices.
One is build a database, insert data, and using some api (say MySQL connector) to fetching data.
The other one is to use some opened/paid and well-defined api to get structured or semi-structured data.</p>
<p>The first one is more practical, but the data source cannot be validated.
I can randomly generate some data and insert it into database, then fetching it to local.
But in this way, it is kind of similar as directly generate data locally.</p>
<p>I chose the latter one, i.e. using an api already exists.</p>
<p>At the beginning, actually I planned to use some weather api doing temperature forecasting.
But the free apis always only provide current data.
The history data is somehow difficult to get.</p>
<p>Luckily, for my planB (this one with Bitcoin), some websites provide good apis with history data. For example, <a href="https://coindesk.com" target="_blank" rel="noopener noreffer ">conindesk</a>.</p>
<p>Python official suggests an api of fetching Bitcoin data.
This package is shown in &ldquo;exchanges&rdquo; folder.
It is written for python 2.
I have modified some files to make it compatible with python 3.</p>
<p>The mainly used api function (modified) is as follow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_historical_data_as_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;2017-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">end</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">get_datetime</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_historical_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;bpi&#39;</span><span class="p">]</span>
    <span class="c1"># prices = {k: Decimal(str(v)) for (k,v) in prices.items()}</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">prices</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">prices</span>
</code></pre></div><p><code>OrderedDict</code> is used for make the dictionary sorted.
Because I noticed that the return value from original message is not shown as the time order.
For more details, please refer to <code>coindesk.py</code> in folder &ldquo;exchanges&rdquo;.</p>
<p>For easy calling, I wrapped it in <code>getBCdata</code> in <code>datafetch.py</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">getBCdata</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2017-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">CoinDesk</span><span class="o">.</span><span class="n">get_historical_data_as_dict</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div><h4 id="222-preparation">2.2.2 Preparation</h4>
<p>Preparation can further divide to two small part.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">startdate</span> <span class="o">=</span> <span class="s1">&#39;2017-01-01&#39;</span>
<span class="n">enddate</span> <span class="o">=</span> <span class="s1">&#39;2017-10-20&#39;</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">enddate</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">getBCdata</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
<span class="c1"># ts = pd.Series([v for (k, v) in ts.items()])</span>
<span class="n">TS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</code></pre></div><p>This part calls predefined api and get data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">num_periods</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">f_horizon</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># forecast horizon, one period into the future</span>

<span class="n">x_data</span> <span class="o">=</span> <span class="n">TS</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">TS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TS</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_periods</span><span class="p">))]</span>
<span class="n">x_batches</span> <span class="o">=</span> <span class="n">x_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">y_data</span> <span class="o">=</span> <span class="n">TS</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="nb">len</span><span class="p">(</span><span class="n">TS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TS</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_periods</span><span class="p">))</span> <span class="o">+</span> <span class="n">f_horizon</span><span class="p">]</span>
<span class="n">y_batches</span> <span class="o">=</span> <span class="n">y_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># print(len(x_batches))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x batches shape&#39;</span><span class="p">,</span> <span class="n">x_batches</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(x_batches[0:2])</span>
<span class="c1"># print(y_batches[0:1])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y batches shape&#39;</span><span class="p">,</span> <span class="n">y_batches</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_data</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">):</span>
    <span class="n">test_x_setup</span> <span class="o">=</span> <span class="n">TS</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">num_periods</span> <span class="o">+</span> <span class="n">forecast</span><span class="p">):]</span>
    <span class="n">testX</span> <span class="o">=</span> <span class="n">test_x_setup</span><span class="p">[:</span><span class="n">num_periods</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">testY</span> <span class="o">=</span> <span class="n">TS</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">num_periods</span><span class="p">):]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span>


<span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">f_horizon</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test shape&#39;</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_test)</span>
</code></pre></div><p>This part parses the data to 20-day blocks and prepare to do training.
Also in this part it chose last 20 days data for testing.
(If the total days mod 20 is not 0, at least some days were not taken as training data, and actually it just predicted one day more).</p>
<h3 id="23-data-processing">2.3 Data processing</h3>
<p>This part is roughly similar to the RNN example from MapR.</p>
<p>Basically, it did some fundamental setting of Tensorflow session and data.</p>
<p>Training activation function was chosen as &ldquo;relu&rdquo;.
The mean square error was chosen as the loss function.
The basic AdamOptimizer was used for minimizing loss function result.</p>
<p>For more details please refer the code and comments.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># didn&#39;t have any previous graph objects running, but this would reset the graphs</span>
<span class="n">tf</span><span class="o">.</span><span class="n">reset_default_graph</span><span class="p">()</span>

<span class="c1"># setted before</span>
<span class="c1"># num_periods = 20      #number of periods per vector we are using to predict one period ahead</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># number of vectors submitted</span>
<span class="n">hidden</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># number of neurons we will recursively work through, can be changed to improve accuracy</span>
<span class="n">output</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># number of output vectors</span>

<span class="c1"># create variable objects</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">,</span> <span class="n">inputs</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">,</span> <span class="n">output</span><span class="p">])</span>

<span class="n">basic_cell</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">rnn</span><span class="o">.</span><span class="n">BasicRNNCell</span><span class="p">(</span>
    <span class="n">num_units</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>  <span class="c1"># create our RNN object</span>
<span class="n">rnn_output</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">dynamic_rnn</span><span class="p">(</span>
    <span class="n">basic_cell</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># choose dynamic over static</span>

<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># small learning rate so we don&#39;t overshoot the minimum</span>

<span class="c1"># change the form into a tensor</span>
<span class="n">stacked_rnn_output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rnn_output</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden</span><span class="p">])</span>
<span class="c1"># specify the type of layer (dense)</span>
<span class="n">stacked_outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">stacked_rnn_output</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="c1"># shape of results</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">stacked_outputs</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">,</span> <span class="n">output</span><span class="p">])</span>

<span class="c1"># define the cost function which evaluates the quality of our model</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">outputs</span> <span class="o">-</span> <span class="n">y</span><span class="p">))</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>  <span class="c1"># gradient descent method</span>
<span class="c1"># train the result of the application of the cost_function</span>
<span class="n">training_op</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span>  <span class="c1"># initialize all the variables</span>

<span class="n">epochs</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1"># number of iterations or training cycles, includes both the FeedFoward and Backpropogation</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">init</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">training_op</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">x_batches</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_batches</span><span class="p">})</span>
</code></pre></div><p>The testing of (with last 20 days results) is quite easy.
To get predicted data:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_test</span><span class="p">})</span>
</code></pre></div><h2 id="3-visualization">3. Visualization</h2>
<h3 id="31-windowslinux">3.1 Windows/Linux</h3>
<p>The main output of Windows/Linux platform.
Here we have four images, the test result of last period of days, loss function (mean square error) result, CPU usage, and memory usage.</p>
<p>For discussion of results please refer to part 4 of this article.</p>
<p>Here are some screenshots.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/all.png"
        data-srcset="/images/bitcoinprice/all.png, /images/bitcoinprice/all.png 1.5x, /images/bitcoinprice/all.png 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/all.png"
        title="all" /></p>
<!-- raw HTML omitted -->
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/result.svg"
        data-srcset="/images/bitcoinprice/result.svg, /images/bitcoinprice/result.svg 1.5x, /images/bitcoinprice/result.svg 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/result.svg"
        title="result" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/loss.svg"
        data-srcset="/images/bitcoinprice/loss.svg, /images/bitcoinprice/loss.svg 1.5x, /images/bitcoinprice/loss.svg 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/loss.svg"
        title="loss" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/cpu.svg"
        data-srcset="/images/bitcoinprice/cpu.svg, /images/bitcoinprice/cpu.svg 1.5x, /images/bitcoinprice/cpu.svg 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/cpu.svg"
        title="cpu" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/mem.svg"
        data-srcset="/images/bitcoinprice/mem.svg, /images/bitcoinprice/mem.svg 1.5x, /images/bitcoinprice/mem.svg 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/mem.svg"
        title="mem" /></p>
<h3 id="32-web-interface">3.2 Web interface</h3>
<p>The web interface is implemented with Tensorboard from Tensorflow.</p>
<p>The first screenshot shows the training process, while other images are pretty similar to general PC platform.</p>
<p>For detailed implementation, please refer the code.</p>
<!-- raw HTML omitted -->
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/training.png"
        data-srcset="/images/bitcoinprice/training.png, /images/bitcoinprice/training.png 1.5x, /images/bitcoinprice/training.png 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/training.png"
        title="training" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/allw.png"
        data-srcset="/images/bitcoinprice/allw.png, /images/bitcoinprice/allw.png 1.5x, /images/bitcoinprice/allw.png 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/allw.png"
        title="allw" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/lossw.png"
        data-srcset="/images/bitcoinprice/lossw.png, /images/bitcoinprice/lossw.png 1.5x, /images/bitcoinprice/lossw.png 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/lossw.png"
        title="lossw" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/cpuw.png"
        data-srcset="/images/bitcoinprice/cpuw.png, /images/bitcoinprice/cpuw.png 1.5x, /images/bitcoinprice/cpuw.png 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/cpuw.png"
        title="cpuw" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bitcoinprice/memw.png"
        data-srcset="/images/bitcoinprice/memw.png, /images/bitcoinprice/memw.png 1.5x, /images/bitcoinprice/memw.png 2x"
        data-sizes="auto"
        alt="/images/bitcoinprice/memw.png"
        title="memw" /></p>
<h2 id="4-discussion-and-summary">4. Discussion and Summary</h2>
<ul>
<li>
<p>Result discussion</p>
<ul>
<li>We can see the prediction of last 20 prices of recently day looks similar to true value on trend.</li>
<li>Overall the loss decrease fast at the beginning but the decreasing rate speed down later at more running cycles.</li>
<li>For each data point, it is still not that accurate. MSE also can support this for still keeping at relatively large value.</li>
<li>It should not be enough to get profits by this easy model. More optimizations need to be done, not only to increase looping times or the hidden middle layers.</li>
<li>CPU usage is normal for training process. I am using an Intel i7-6700K CPU (4 core, 8 hyperthreads) with 16G DDR4 RAM.</li>
<li>Memory usage also looks good, running more cycles did not cost much more memory.</li>
</ul>
</li>
<li>
<p>By going through all of those steps, I learned the basics of machine learning steps as well as got to know the working logic of Tensorflow.</p>
</li>
<li>
<p>The final visualization adjusting/debugging and documenting costed more time than I expected.
Next time I need to leave more time for those steps.</p>
</li>
</ul>
<h2 id="reference">Reference</h2>
<p><a href="https://en.wikipedia.org/wiki/Time_series" target="_blank" rel="noopener noreffer ">https://en.wikipedia.org/wiki/Time_series</a></p>
<p><a href="https://medium.com/google-cloud/how-to-do-time-series-prediction-using-rnns-and-tensorflow-and-cloud-ml-engine-2ad2eeb189e8" target="_blank" rel="noopener noreffer ">https://medium.com/google-cloud/how-to-do-time-series-prediction-using-rnns-and-tensorflow-and-cloud-ml-engine-2ad2eeb189e8</a></p>
<p><a href="https://mapr.com/blog/deep-learning-tensorflow/" target="_blank" rel="noopener noreffer ">https://mapr.com/blog/deep-learning-tensorflow/</a></p>
<p><a href="https://github.com/dursk/bitcoin-price-api" target="_blank" rel="noopener noreffer ">https://github.com/dursk/bitcoin-price-api</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-02-04</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://ysmiles.com/posts/bitcoin-price-prediction/" data-hashtag="TensorFlow"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://ysmiles.com/posts/bitcoin-price-prediction/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://ysmiles.com/posts/bitcoin-price-prediction/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://ysmiles.com/posts/bitcoin-price-prediction/" data-title="Bitcoin price prediction"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/tensorflow/">TensorFlow</a>,&nbsp;<a href="/tags/rnn/">RNN</a>,&nbsp;<a href="/tags/bitcoin/">Bitcoin</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/run-a-basic-grpc-example-with-docker/" class="prev" rel="prev" title="Run a basic gRPC example with Docker"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Run a basic gRPC example with Docker</a>
            <a href="/posts/http-server-inside-a-docker-container/" class="next" rel="next" title="HTTP server inside a docker container">HTTP server inside a docker container<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://ysmiles.com" target="_blank">Frederick</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://ysmiles.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
